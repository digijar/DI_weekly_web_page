<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previewing tables</title>
    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .navbar {
            position: sticky;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 1000; /* Ensure Navbar is above other content */
        }

        .navbar-nav {
            margin-right: auto;
        }

        .tile-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Adjust grid-template-columns for the last tile */
        .tile-container .tile-center {
            grid-column: span 2; /* Span 2 columns for the centered tile */
        }

        .tile {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .tile img {
            width: 100%;
            height: auto;
            object-fit: cover;
            vertical-align: middle;
        }

        .tile-title {
            padding: 10px;
            text-align: center;
            background-color: #fff;
        }

        .tile:hover {
            transform: scale(1.05);
        }

        .tile-center {
            margin: 0 auto; /* This centers the tile horizontally */
        }

        /* Add this CSS to style the displayed table */
        .table {
            width: 100%;
            border-collapse: collapse;
            position: relative;
        }

        .table th,
        .table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .table td {
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .table th {
            position: sticky;
            top: 0px; /* 63px for below navbar */
            background-color: #dbdbdb; /* Set the background color */
            color: black; /* Set the text color */
            z-index: 1001;
        }

        /* Add this CSS to adjust the layout when table is displayed */
        .table-details {
            max-width: 800px;
            padding: 0;
        }

        /* Add this CSS to change cell color when editing starts */
        .table td[contenteditable="true"]:focus {
            background-color: orange;
        }
        .table td.expanded div[contenteditable="true"]:focus {
            background-color: orange;
            padding: 8px;
            margin: -8px; /* Counteract padding to maintain cell size */
            border: 1px solid #ccc;
            white-space: normal;
            overflow: visible;
        }

        .button-container {
            display: flex; /* Use flexbox to align buttons horizontally */
            align-items: center; /* Center items vertically within the container */
            margin-top: 10px; /* Adjust margin as needed */
        }

        .save-button,
        .refresh-button {
            margin-right: 10px; /* Add space between buttons */
        }

        /* Add this CSS to style the "Expand" button */
        .expand-button {
            border-radius: 10px;
            border: none;
            display: inline-block;
            cursor: pointer;
        }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <!-- <a class="navbar-brand" href="#">Excel File Upload to BigQuery</a> -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Upload</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/model_testing">Model Testing</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/view_table">View Table</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/preview">Preview Tables</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/slicer">Excel Slicer</a>
                    </li>
                </ul>
            </div>

            <div class="button-container">
                <div class="table-name"></div>
                <div class="refresh-button"></div>
                <div class="save-button"></div>
            </div>
        </div>
    </nav>

    <div id="slicer-container">
        <!-- Dropdown slicers will be generated here -->
    </div>

    <div class="table-details" style="display: none;">
        <!-- Table Data from BigQuery will be generated here -->
    </div>

    <div class="tile-container">
        <div class="tile" id="merger-market">
            <img src="{{ url_for('static', filename='images/MergerMarket.jpg') }}">
            <div class="tile-title">MergerMarket</div>
        </div>
        <div class="tile" id="weekly-scan">
            <img src="{{ url_for('static', filename='images/Market_Scan.jpg') }}">
            <div class="tile-title">Market Scan</div>
        </div>
        <div class="tile tile-center" id="rolling-shortlist">
            <img src="{{ url_for('static', filename='images/Rolling_Shortlist.jpg') }}">
            <div class="tile-title">Rolling Shortlist</div>
        </div>
    </div>
    

    <!-- Add any JavaScript links or scripts here -->
    <!-- Add the SheetJS library for Excel file handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <!-- Add Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

    <!-- Add jQuery for making AJAX requests -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function() {

            // To display MergerMarket table
            function displayMergerMarket() {
                $.get(`http://127.0.0.1:5003/get_mergermarket`, function(data) {
                    tableName = "MergerMarket"

                    const columnOrder = [
                        "Opportunity_ID",
                        "Date",
                        "Value INR_m",
                        "Value Description",
                        "Heading",
                        "Opportunity",
                        "Targets",
                        "Lead type",
                        "Type of transaction",
                        "HS sector classification",
                        "Short BD",
                        "Source",
                        "Intelligence Type",
                        "Intelligence Grade",
                        "Intelligence Size",
                        "Stake Value",
                        "Dominant Sector",
                        "Sectors",
                        "Sub Sectors",
                        "Dominant Geography",
                        "Geography",
                        "States",
                        "Topics",
                        "Bidders",
                        "Vendors",
                        "Issuers",
                        "Competitors",
                        "Others",
                        "Completed"
                    ];

                    const tableData = data; // Already parsed JSON

                    // Generate a table HTML using the fetched data
                    let tableHtml = '<table class="table">';
                        
                    // Generate table headers
                    tableHtml += '<thead><tr>';
                    for (const columnName of columnOrder) {
                        tableHtml += `<th>${columnName}</th>`;
                    }
                    tableHtml += '</tr></thead>';
                    
                    // Generate table rows
                    tableHtml += '<tbody>';
                    for (const opportunityId in tableData) {
                        const row = tableData[opportunityId];
                        tableHtml += '<tr>';
                        for (const columnName of columnOrder) {
                            const cellContent = row[columnName];
                            if (cellContent !== null) {
                                if (cellContent.length > 30) {
                                    const uniqueID = `modal-${columnName.substring(0, 3)}`;
                                    tableHtml += `
                                        <td data-col-name="${columnName}" data-full-content="${cellContent}">${cellContent.substring(0, 30)}
                                            <span><button class="expand-button" data-bs-toggle="modal" data-bs-target="#${uniqueID}">...</button></span>
                                            <div class="modal fade" id="${uniqueID}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-scrollable">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body"></div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            <button type="button" id="save-changes" class="btn btn-primary">Save changes</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        `;
                                } else {
                                    tableHtml += `<td data-col-name="${columnName}" contenteditable="true">${cellContent}</td>`;
                                }
                            } else {
                                tableHtml += `<td> </td>`;
                            }
                        }
                        tableHtml += '</tr>';
                    }

                    // Add editable attribute to each cell
                    tableHtml = tableHtml.replace(/<td>/g, '<td contenteditable="true">');

                    // Append table name
                    tableNameHtml = `<h4 style='margin-right: 10px;'>${tableName}</h4>`
                    $('.table-name').html(tableNameHtml);

                    // Append Save Changes button
                    saveHtml = '<button id="save-changes" class="btn btn-primary">Save Changes</button>';
                    $('.save-button').html(saveHtml);

                    // Append Refresh Changes button
                    refreshHtml = '<button class="btn btn-success" onClick="window.location.reload();">Go Back</button>';
                    $('.refresh-button').html(refreshHtml);

                    // Update the table details placeholder and show it
                    $('.table-details').html(tableHtml).show();

                    // Hide the tile container
                    $('.tile-container').hide();

                    // Generate dropdown slicers for each column
                    const slicerContainer = document.getElementById("slicer-container");

                    for (const columnName of columnOrder) {
                        // if (columnName in (""))
                        const uniqueValues = [...new Set(tableData.map(row => row[columnName]))];
                        
                        const dropdown = document.createElement("select");
                        dropdown.setAttribute("data-col-name", columnName);
                        
                        const defaultOption = document.createElement("option");
                        defaultOption.value = "";
                        defaultOption.text = `Filter ${columnName}`;
                        dropdown.appendChild(defaultOption);
                        
                        for (const value of uniqueValues) {
                            const option = document.createElement("option");
                            option.value = value;
                            option.text = value;
                            dropdown.appendChild(option);
                        }

                        dropdown.addEventListener("change", updateTable);
                        slicerContainer.appendChild(dropdown);
                    }
                });
            }

            // FUNCTIONS FOR SLICER
            function updateTable() {
                const filters = {};

                // Get selected filter values
                const dropdowns = slicerContainer.querySelectorAll("select");
                dropdowns.forEach(dropdown => {
                    const columnName = dropdown.getAttribute("data-col-name");
                    const selectedValue = dropdown.value;
                    if (selectedValue !== "") {
                        filters[columnName] = selectedValue;
                    }
                });

                // Apply filters and update the displayed table
                const filteredData = applyFilters(tableData, filters);
                renderContent(filteredData);
            }

            function applyFilters(data, filters) {
                return data.filter(row => {
                    for (const columnName in filters) {
                        if (row[columnName] !== filters[columnName]) {
                            return false;
                        }
                    }
                    return true;
                });
            }

            // Function specifically for MergerMarket table
            function updateMergerMarket() {
                const editedCell = $('.table td.editing'); // Get the edited cell
                const tableName = "MergerMarket";

                if (editedCell.length === 0) {
                    const editedModal = $('div.editing');
                    if (editedModal.length === 0) {
                        alert("No cell is being edited.");
                        return; 
                    }
                }

                const opportunityId = editedCell.closest('tr').find('td:nth-child(1)').text(); // 16th column is Opportunity_ID
                const columnName = editedCell.data('col-name');
                const cellValue = editedCell.text();

                console.log(opportunityId);
                console.log(columnName);
                console.log(cellValue);

                const updatedRow = {
                    row_id: opportunityId,
                    column_name: columnName,
                    edited_value: cellValue
                };

                // Send the updated data to the backend
                $.ajax({
                    url: `http://127.0.0.1:5003/update_mergermarket`,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify([updatedRow]),
                    success: function(response) {
                        console.log(response);
                        if (response.success) {
                            console.log("edit successful!");
                            alert("Edit successful!");
                            displayMergerMarket(); // Reload the table after successful update
                        } else {
                            displayErrorMessage("An error occurred while saving changes.");
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(error);
                        displayErrorMessage("An error occurred while saving changes.");
                    }
                });
            }

            function displayErrorMessage(message) {
                // Display error message to the user, e.g., using a modal or a notification
                console.log(message);
            }

            // To display Market Scan table
            function displayMarketScan() {
                $.get(`http://127.0.0.1:5003/get_marketscan`, function(data) {
                    tableName = "Market Scan"

                    const columnOrder = [
                        "Num",
                        "Picks",
                        "Captured in the week",
                        "Date",
                        "Lead type",
                        "Target HS industry classification",
                        "Dominant sector_as per MM",
                        "Sectors_as per MM",
                        "Sub Sectors_as per MM",
                        "HS Target region",
                        "Dominant country",
                        "Countries",
                        "Next Steps",
                        "Target",
                        "Target_Chinese",
                        "Deal intelligence",
                        "Short BD",
                        "Bidders",
                        "Sellers_or_Vendors",
                        "Type of transaction",
                        "Intelligence type_as per MM",
                        "Topics_as per MM",
                        "Value_USDm",
                        "Value description",
                        "Intelligence size",
                        "Intelligence size bucket",
                        "Stake value_percent",
                        "Held by ASPAC priority firm_Y_or_N",
                        "PE priority firm ",
                        "Held since",
                        "Held for more than three years_Y_N_NA",
                        "KPMG credentials_PE_Company_Both_N",
                        "KPMG firm",
                        "Engagement partner",
                    ];

                    const tableData = data; // Already parsed JSON

                    // Generate a table HTML using the fetched data
                    let tableHtml = '<table class="table">';
                        
                    // Generate table headers
                    tableHtml += '<thead><tr>';
                    for (const columnName of columnOrder) {
                        tableHtml += `<th>${columnName}</th>`;
                    }
                    tableHtml += '</tr></thead>';
                    
                    // Generate table rows
                    tableHtml += '<tbody>';
                    for (const opportunityId in tableData) {
                        const row = tableData[opportunityId];
                        tableHtml += '<tr>';
                        for (const columnName of columnOrder) {
                            const cellContent = row[columnName];
                            if (cellContent !== null) {
                                if (cellContent.length > 30) {
                                    const uniqueID = `modal-${columnName.substring(0, 3)}`;
                                    tableHtml += `
                                        <td data-col-name="${columnName}" data-full-content="${cellContent}">${cellContent.substring(0, 30)}
                                            <span><button class="expand-button" data-bs-toggle="modal" data-bs-target="#${uniqueID}">...</button></span>
                                            <div class="modal fade" id="${uniqueID}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-scrollable">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body"></div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            <button type="button" id="save-changes" class="btn btn-primary">Save changes</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        `;
                                } else {
                                    tableHtml += `<td data-col-name="${columnName}" contenteditable="true">${cellContent}</td>`;
                                }
                            } else {
                                tableHtml += `<td> </td>`;
                            }
                        }
                        tableHtml += '</tr>';
                    }

                    // Add editable attribute to each cell
                    tableHtml = tableHtml.replace(/<td>/g, '<td contenteditable="true">');

                    // Append table name
                    tableNameHtml = `<h4 style='margin-right: 10px;'>${tableName}</h4>`
                    $('.table-name').html(tableNameHtml);

                    // Append Save Changes button
                    saveHtml = '<button id="save-changes" class="btn btn-primary">Save Changes</button>';
                    $('.save-button').html(saveHtml);

                    // Append Refresh Changes button
                    refreshHtml = '<button class="btn btn-success" onClick="window.location.reload();">Go Back</button>';
                    $('.refresh-button').html(refreshHtml);

                    // Update the table details placeholder and show it
                    $('.table-details').html(tableHtml).show();

                    // Hide the tile container
                    $('.tile-container').hide();
                });
            }


            // Function specifically for Market Scan table
            function updateMarketScan() {
                const editedCell = $('.table td.editing'); // Get the edited cell
                const tableName = "Market Scan";

                if (editedCell.length === 0) {
                    const editedModal = $('div.editing');
                    if (editedModal.length === 0) {
                        alert("No cell is being edited.");
                        return; 
                    }
                }

                const Num = editedCell.closest('tr').find('td:nth-child(1)').text(); // 1st column is Num (unique row id)
                const columnName = editedCell.data('col-name');
                const cellValue = editedCell.text();

                console.log(Num);
                console.log(columnName);
                console.log(cellValue);

                const updatedRow = {
                    row_id: Num,
                    column_name: columnName,
                    edited_value: cellValue
                };

                // Send the updated data to the backend
                $.ajax({
                    url: `http://127.0.0.1:5003/update_marketscan`,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify([updatedRow]),
                    success: function(response) {
                        console.log(response);
                        if (response.success) {
                            console.log("edit successful!");
                            alert("Edit successful!");
                            displayMarketScan(); // Reload the table after successful update
                        } else {
                            displayErrorMessage("An error occurred while saving changes.");
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(error);
                        displayErrorMessage("An error occurred while saving changes.");
                    }
                });
            };


            function displayRollingShortlist() {
                $.get(`http://127.0.0.1:5003/get_rollingshortlist`, function(data) {
                    tableName = "Rolling Shortlist"

                    const columnOrder = [
                    "Num",
                    "Captured date",
                    "BP comments",
                    "Partner_or_Director",
                    "Target country",
                    "Sub sector",
                    "Source",
                    " Target",
                    "Business Description",
                    "Financials",
                    "Revenue_USD_M",
                    "EBITDA_USD_M",
                    "Valuation_USD_M",
                    "Other Info",
                    "Deal Intelligence info",
                    "News Date",
                    "KPMG View - Redacted",
                    "Credentials",
                    "HS contact",
                    "Investment date",
                    "Geographic region",
                    "Asset pack ",
                    "Target Region",
                    "Shareholders",
                    "Lead type",
                    "Target HS industry classification ",
                    "Stake for sale_percent",
                    "Value_USD_M",
                    "Value description ",
                    "Website",
                    ];

                    const tableData = data; // Already parsed JSON

                    // Generate a table HTML using the fetched data
                    let tableHtml = '<table class="table">';
                        
                    // Generate table headers
                    tableHtml += '<thead><tr>';
                    for (const columnName of columnOrder) {
                        tableHtml += `<th>${columnName}</th>`;
                    }
                    tableHtml += '</tr></thead>';
                    
                    // Generate table rows
                    tableHtml += '<tbody>';
                    for (const opportunityId in tableData) {
                        const row = tableData[opportunityId];
                        tableHtml += '<tr>';
                        for (const columnName of columnOrder) {
                            const cellContent = row[columnName];
                            if (cellContent !== null) {
                                if (cellContent.length > 30) {
                                    const uniqueID = `modal-${columnName.substring(0, 3)}`;
                                    tableHtml += `
                                        <td data-col-name="${columnName}" data-full-content="${cellContent}">${cellContent.substring(0, 30)}
                                            <span><button class="expand-button" data-bs-toggle="modal" data-bs-target="#${uniqueID}">...</button></span>
                                            <div class="modal fade" id="${uniqueID}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-scrollable">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body"></div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            <button type="button" id="save-changes" class="btn btn-primary">Save changes</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        `;
                                } else {
                                    tableHtml += `<td data-col-name="${columnName}" contenteditable="true">${cellContent}</td>`;
                                }
                            } else {
                                tableHtml += `<td> </td>`;
                            }
                        }
                        tableHtml += '</tr>';
                    }

                    // Add editable attribute to each cell
                    tableHtml = tableHtml.replace(/<td>/g, '<td contenteditable="true">');

                    // Append table name
                    tableNameHtml = `<h4 style='margin-right: 10px;'>${tableName}</h4>`
                    $('.table-name').html(tableNameHtml);

                    // Append Save Changes button
                    saveHtml = '<button id="save-changes" class="btn btn-primary">Save Changes</button>';
                    $('.save-button').html(saveHtml);

                    // Append Refresh Changes button
                    refreshHtml = '<button class="btn btn-success" onClick="window.location.reload();">Go Back</button>';
                    $('.refresh-button').html(refreshHtml);

                    // Update the table details placeholder and show it
                    $('.table-details').html(tableHtml).show();

                    // Hide the tile container
                    $('.tile-container').hide();
                });
            }


            // Function specifically for Rolling Shortlist table
            function updateRollingShortlist() {
                const editedCell = $('.table td.editing'); // Get the edited cell
                const tableName = "Rolling Shortlist";

                if (editedCell.length === 0) {
                    const editedModal = $('div.editing');
                    if (editedModal.length === 0) {
                        alert("No cell is being edited.");
                        return; 
                    }
                }

                const Num = editedCell.closest('tr').find('td:nth-child(1)').text(); // 1st column is Num (unique row id)
                const columnName = editedCell.data('col-name');
                const cellValue = editedCell.text();

                console.log(Num);
                console.log(columnName);
                console.log(cellValue);

                const updatedRow = {
                    row_id: Num,
                    column_name: columnName,
                    edited_value: cellValue
                };

                // Send the updated data to the backend
                $.ajax({
                    url: `http://127.0.0.1:5003/update_rollingshortlist`,
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify([updatedRow]),
                    success: function(response) {
                        console.log(response);
                        if (response.success) {
                            console.log("edit successful!");
                            alert("Edit successful!");
                            displayRollingShortlist(); // Reload the table after successful update
                        } else {
                            displayErrorMessage("An error occurred while saving changes.");
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error(error);
                        displayErrorMessage("An error occurred while saving changes.");
                    }
                });
            };

            $('.tile').click(function() {
                const tableName = $(this).find('.tile-title').text();

                if (tableName === "MergerMarket") {
                    displayMergerMarket();
                } else if (tableName === "Market Scan") {
                    displayMarketScan();
                } else {
                    displayRollingShortlist()
                }
            });

            $(document).on('click', '#save-changes', function() {
                const tableName = $('.table-name').text();
                if (tableName === "MergerMarket") {
                    updateMergerMarket();
                } else if (tableName === "Market Scan") {
                    updateMarketScan();
                } else {
                    updateRollingShortlist();
                }
                
            });
            
            $(document).on('click', '.expand-button', function() {
                const modalId = $(this).data('bs-target'); // Get the modal's target ID
                const cellContent = $(this).closest('td').data('full-content');
                
                // Find the modal using its unique ID and show it
                $(modalId).find('.modal-body').html(`<div contenteditable="true">${cellContent}</div>`);
                console.log(modalId)
                console.log(cellContent)
                $(modalId).modal('show');
            });

            $(document).on('focus', '.table td[contenteditable="true"]', function() {
                console.log("This cell is being edited!");
                $(this).addClass('editing');
            });

            $(document).on('focus', 'div[contenteditable="true"]', function() {
                console.log("This cell is being edited!");
                $(this).addClass('editing');
            });
        });


    </script>
</body>
</html>